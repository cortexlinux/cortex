name: Auto-Reopen Phase Issues

on:
  milestone:
    types: [closed]

jobs:
  reopen-issues:
    runs-on: ubuntu-latest
    steps:
      - name: Reopen issues for next phase
        uses: actions/github-script@v7
        with:
          script: |
            const milestone = context.payload.milestone;
            const milestoneName = milestone.title.toLowerCase();
            
            let labelToReopen = null;
            
            if (milestoneName.includes('mvp')) {
              labelToReopen = 'phase:post-mvp';
            } else if (milestoneName.includes('funding')) {
              labelToReopen = 'phase:post-funding';
            } else if (milestoneName.includes('enterprise')) {
              labelToReopen = 'phase:enterprise';
            }
            
            if (!labelToReopen) {
              console.log('No matching phase label for milestone:', milestone.title);
              return;
            }
            
            console.log(`Reopening issues with label: ${labelToReopen}`);
            
            // Get all closed issues with the phase label
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'closed',
              labels: labelToReopen,
              per_page: 100
            });
            
            console.log(`Found ${issues.data.length} issues to reopen`);
            
            for (const issue of issues.data) {
              if (!issue.pull_request) {
                await github.rest.issues.update({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  state: 'open'
                });
                console.log(`Reopened #${issue.number}: ${issue.title}`);
              }
            }
            
            // Post summary comment on milestone
            console.log(`âœ… Reopened ${issues.data.length} issues for ${labelToReopen}`);
